# Miomente Partner Portal - План развития

## Обзор
Этот документ описывает планируемые функции на основе анализа конкурентов (Konfetti) и бизнес-требований.

---

## Фаза 1: Быстрые победы (Меню и заглушки)

### 1.1 Добавить пункты меню
- [ ] **Bestellungen** (Заказы) - Добавить в боковое меню
- [ ] **Buchhaltung** (Бухгалтерия) - Добавить в боковое меню
- [ ] Отображать страницы-заглушки "In Entwicklung. Coming soon"

**Реализация:** Добавить новые маршруты в `src/app/dashboard/`, создать простые компоненты-заглушки с сообщением.

---

## Фаза 2: Управление заказами (Bestellungen)

### 2.1 Список заказов
- [ ] Отображение всех бронирований курсов партнёра
- [ ] Показывать: Имя клиента, курс, дата, количество билетов, статус, общая сумма
- [ ] Фильтры: диапазон дат, курс, статус
- [ ] Пагинация

**Реализация:**
- Создать эндпоинт `/api/partner/orders`
- Запросы к таблицам Magento `sales_order` + `sales_order_item`
- JOIN с данными курсов по SKU продукта

### 2.2 Детали заказа
- [ ] Просмотр отдельного заказа со всеми деталями
- [ ] Контактная информация клиента
- [ ] Статус оплаты
- [ ] История/таймлайн заказа

**Реализация:** Создать эндпоинт `/api/partner/orders/[id]`, новую страницу деталей.

### 2.3 Подтверждение заказов
- [ ] Партнёр может подтверждать/отклонять бронирования
- [ ] Отправка письма-подтверждения клиенту
- [ ] Обновление статуса заказа в Magento

**Реализация:** PATCH эндпоинт для обновления статуса, интеграция с шаблонами SendGrid.

---

## Фаза 3: Бухгалтерия (Buchhaltung)

### 3.1 Дашборд выручки
- [ ] Графики выручки по месяцам/годам
- [ ] Разбивка выручки по курсам
- [ ] Сравнение с предыдущими периодами

**Реализация:**
- Агрегация данных заказов по периодам
- Использовать библиотеку графиков (recharts уже в проекте)
- Создать эндпоинт `/api/partner/stats/revenue`

### 3.2 Список счетов
- [ ] Просмотр всех счетов от Miomente
- [ ] Скачивание PDF счетов
- [ ] Фильтры по дате, статусу

**Реализация:**
- Хранить счета в Supabase или получать из бухгалтерской системы
- Генерация PDF с деталями выплат партнёру

### 3.3 Отчёты по выплатам
- [ ] Показывать расчёты комиссий
- [ ] Ожидаемые даты выплат
- [ ] История выплат

**Реализация:** Создать логику расчёта выплат на основе комиссий с заказов.

---

## Фаза 4: Повторяющиеся мероприятия (Wiederholende Termine)

### 4.1 Шаблоны повторяющихся дат
- [ ] Создание шаблона даты с паттерном повторения
- [ ] Опции: Ежедневно, Еженедельно, Ежемесячно, Произвольно
- [ ] Установка даты окончания или количества повторений
- [ ] Автоматическая генерация дат по паттерну

**Реализация:**
- Добавить таблицу `recurring_pattern` в Supabase
- Фоновая задача (cron) для генерации дат
- Или генерация по запросу при просмотре календаря
- Хранить паттерн: `{ frequency: 'monthly', day: 15, endDate: '2025-12-31' }`

### 4.2 Массовое управление датами
- [ ] Редактирование всех будущих повторяющихся дат сразу
- [ ] Отмена всей серии
- [ ] Обработка исключений (пропуск определённых дат)

**Реализация:** Добавить `series_id` к датам, запросы массового обновления.

---

## Фаза 5: Лист ожидания и запросы дат (Warteliste)

### 5.1 Просмотр листа ожидания
- [ ] Показывать курсы с ожидающими клиентами
- [ ] Количество заинтересованных клиентов на курс
- [ ] Быстрое действие: "Добавить новую дату"

**Реализация:**
- Создать таблицу waitlist в Supabase
- API эндпоинт `/api/partner/waitlist`
- Уведомлять клиентов при добавлении новых дат

### 5.2 Запросы дат (Terminanfragen)
- [ ] Клиенты могут запрашивать конкретные даты
- [ ] Партнёр видит запросы с количеством клиентов
- [ ] Принятие/Отклонение запросов
- [ ] Автоматическое уведомление клиентов о решении

**Реализация:**
- Новая таблица `date_requests`
- Workflow статусов: pending → approved/rejected
- Email уведомления через SendGrid

---

## Фаза 6: Управление отзывами (Bewertungen)

### 6.1 Дашборд отзывов
- [ ] Просмотр всех отзывов клиентов
- [ ] Средний рейтинг по курсу
- [ ] Общий рейтинг партнёра

**Реализация:**
- Запросы к таблицам отзывов Magento или создать свои в Supabase
- API эндпоинт для агрегации рейтингов

### 6.2 Ответы на отзывы
- [ ] Партнёр может отвечать на отзывы
- [ ] Ответ отображается на сайте

**Реализация:** Добавить поле `partner_response`, workflow модерации.

### 6.3 Сбор отзывов
- [ ] Автоматические письма с просьбой оставить отзыв после мероприятия
- [ ] Напоминания для не ответивших

**Реализация:** Запланированная задача для отправки запросов отзывов через X дней после мероприятия.

---

## Фаза 7: Маркетинговые инструменты

### 7.1 SEO рекомендации
- [ ] Оценка качества контента курса
- [ ] Предупреждения о незаполненных полях
- [ ] Рекомендации ключевых слов

**Реализация:** Алгоритм анализа контента, UI с чеклистом.

### 7.2 Раздел лучших практик
- [ ] Советы для успешных курсов
- [ ] Рекомендации по ценообразованию
- [ ] Рекомендации по фотографиям

**Реализация:** Статические страницы с примерами.

---

## Фаза 8: Техническая интеграция

### 8.1 Виджет бронирования
- [ ] Встраиваемый виджет для сайтов партнёров
- [ ] Показывает доступные даты
- [ ] Прямой процесс бронирования

**Реализация:**
- Создать отдельный бандл виджета
- iframe или JS embed код
- Публичные API эндпоинты для виджета

### 8.2 API доступ
- [ ] Управление API ключами партнёров
- [ ] Документация для внешних интеграций
- [ ] Webhook уведомления

**Реализация:**
- Генерация API ключей в настройках
- Rate limiting
- Система подписки на webhooks

---

## Фаза 9: Коммуникации

### 9.1 Раздел новостей/обновлений
- [ ] Объявления от Miomente
- [ ] Анонсы новых функций
- [ ] Обновления платформы

**Реализация:** Простая CMS или новости на markdown в Supabase.

### 9.2 SMS уведомления (Будущее)
- [ ] SMS напоминания клиентам
- [ ] Настройки уведомлений партнёра

**Реализация:** Интеграция SMS провайдера (Twilio/MessageBird).

---

## Матрица приоритетов

| Функция | Влияние | Сложность | Приоритет |
|---------|---------|-----------|-----------|
| Заглушки меню | Низкое | Низкая | P1 - Сейчас |
| Список заказов | Высокое | Средняя | P1 - Сейчас |
| Дашборд выручки | Высокое | Средняя | P2 - Следующий |
| Повторяющиеся даты | Высокое | Высокая | P2 - Следующий |
| Лист ожидания | Среднее | Средняя | P3 - Позже |
| Отзывы | Среднее | Средняя | P3 - Позже |
| Виджет бронирования | Высокое | Высокая | P4 - Будущее |

---

## Дополнения к схеме БД

```sql
-- Дополнения Supabase

-- Лист ожидания
CREATE TABLE miomente_waitlist (
  id SERIAL PRIMARY KEY,
  course_id INTEGER NOT NULL,
  customer_email VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Запросы дат
CREATE TABLE miomente_date_requests (
  id SERIAL PRIMARY KEY,
  course_id INTEGER NOT NULL,
  requested_date DATE NOT NULL,
  customer_email VARCHAR(255) NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT NOW()
);

-- Паттерны повторений
CREATE TABLE miomente_recurring_patterns (
  id SERIAL PRIMARY KEY,
  course_id INTEGER NOT NULL,
  frequency VARCHAR(20) NOT NULL, -- daily, weekly, monthly
  interval INTEGER DEFAULT 1,
  day_of_week INTEGER, -- 0-6 для еженедельных
  day_of_month INTEGER, -- 1-31 для ежемесячных
  start_date DATE NOT NULL,
  end_date DATE,
  occurrences INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Новости/Объявления
CREATE TABLE miomente_announcements (
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  published_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## Примечания
- Все новые функции должны следовать существующим паттернам (React Query, Zustand, shadcn/ui)
- Обязательна поддержка немецкого языка для всего пользовательского интерфейса
- Обязателен адаптивный дизайн для мобильных устройств
